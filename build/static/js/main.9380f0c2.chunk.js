(this.webpackJsonpwebapp=this.webpackJsonpwebapp||[]).push([[0],{47:function(e,n,t){},57:function(e,n,t){"use strict";t.r(n);var c,o=t(0),i=t.n(o),r=t(35),s=t.n(r),l=(t(47),t(31)),a=t(2),d=t(1),u=function(){return Object(o.useEffect)((function(){}),[]),Object(d.jsx)("div",{children:"Create Meeting Page"})},j=t(24),b=t(20),f=t(28),p=t(42),g=t(3),h=t(4),O={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"},{urls:"turn:turnsrv.rayabharitechnologies.com:3478",username:"turnuser",credential:"1340"}]},m=new(function(){function e(){Object(g.a)(this,e),this.connections={}}return Object(h.a)(e,[{key:"addPeer",value:function(e,n,t,c){this.connections[e]||(this.connections[e]={peer:new RTCPeerConnection(O)}),n&&(this.connections[e].peer.onicecandidate=n),t&&(this.connections[e].peer.onaddstream=t),c&&(this.connections[e].peer.ontrack=c)}}]),e}()),x=null;function v(e){console.log(e)}var y=function(){Object(a.f)().id;var e=Object(o.useState)({}),n=Object(f.a)(e,2),t=(n[0],n[1]),i=Object(o.useState)({}),r=Object(f.a)(i,2),s=r[0],l=r[1],u=Object(o.useState)(""),g=Object(f.a)(u,2),h=(g[0],g[1]),O=Object(o.useRef)({}),y=(Object(o.useRef)(null),Object(o.useRef)(null));Object(o.useRef)(null);Object(o.useEffect)((function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){c=e,e.onaddtrack=function(e){console.log(e)},setTimeout((function(){var n=document.getElementById("myStreem");console.log(n,x.id),n.srcObject=e}),1e3)})).catch((function(e){return console.log(e)})),(x=p.a.connect("https://signal.rayabharitechnologies.com/",{secure:!1},{transports:["websocket"]})).on("connect",(function(){h(x.id),console.log("connected",x.id),x.emit("JOIN-CALL",{callID:"1234",userName:"name"}),x.emit("GET-USERS-LIST",{callID:"1234",userName:"name"})})),x.on("signal",(function(e,n){if(!m.connections[e]){m.addPeer(e,(function(n){null!=n.candidate&&x.emit("signal",e,{ice:n.candidate,from:x.id})}),(function(){}),(function(n){var t=document.getElementById(e);console.log("got remote stream +++++++++++++++++++++++",n),t.srcObject=n.streams[0]})),console.log("adding track");var t=c.getVideoTracks()[0];m.connections[e].peer.addTrack(t,c)}n.sdp?m.connections[e].peer.setRemoteDescription(new RTCSessionDescription(n.sdp)).then((function(){"offer"===n.sdp.type&&m.connections[e].peer.createAnswer().then((function(n){console.log("got description"),m.connections[e].peer.setLocalDescription(n).then((function(){x.emit("signal",e,{sdp:m.connections[e].peer.localDescription,from:x.id})})).catch(v)})).catch(v)})).catch(v):n.ice&&(console.log(n),m.connections[e].peer.addIceCandidate(new RTCIceCandidate(n.ice)).catch(v))})),x.on("USER-JOINED",(function(e){O.current||(O.current={}),O.current=Object(b.a)(Object(b.a)({},O.current),{},Object(j.a)({},e,{})),console.log("user joined"),t(O.current)})),x.on("USERS-LIST",(function(e){console.log(e),O.current=Object(b.a)({},e),t(O.current)})),x.on("USER-LEFT",(function(e){O.current||(O.current={}),delete O.current[e],O.current=Object(b.a)({},O.current),t(O.current)})),setInterval((function(){Object.keys(O.current).map((function(e){var n,t,c,o;e!==x.id&&(console.log("connect",e),console.log(null===(n=m.connections[e])||void 0===n||null===(t=n.peer)||void 0===t?void 0:t.connectionState),y.current=Object(b.a)(Object(b.a)({},y.current),{},Object(j.a)({},e,null===(c=m.connections[e])||void 0===c||null===(o=c.peer)||void 0===o?void 0:o.connectionState)),l(y.current),console.log(s),m.connections[e]||S(e))}))}),2e3)}),[]);var S=function(e){if(!m.connections[e]){m.addPeer(e,(function(n){null!=n.candidate&&x.emit("signal",e,{ice:n.candidate,from:x.id})}),(function(){}),(function(n){document.getElementById(e).srcObject=n.streams[0]}));var n=c.getVideoTracks()[0];m.connections[e].peer.addTrack(n,c),m.connections[e].peer.createOffer().then((function(n){console.log("got description"),m.connections[e].peer.setLocalDescription(n).then((function(){x.emit("signal",e,{sdp:m.connections[e].peer.localDescription})})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),x.emit("signal",e,{to:e,from:x.id,signal:"ok"})}};return Object(d.jsxs)("div",{style:{position:"absolute",height:"100%",width:"100%",border:"1px solid red",display:"flex",flexDirection:"column"},children:[Object(d.jsx)("div",{children:"Header"}),Object(d.jsxs)("div",{style:{flex:1,border:"1px solid green",display:"flex"},children:[Object(d.jsx)("div",{style:{flex:1,border:"1px solid blue",display:"flex",flexWrap:"wrap"},children:Object(d.jsx)("video",{id:"myStreem",autoPlay:!0,muted:!0,style:{border:"1px solid green",width:500,height:500}})}),Object(d.jsx)("div",{style:{border:"1px solid pink",overflow:"scroll"},children:Object.keys(O.current).map((function(e,n){return Object(d.jsx)("div",{children:x&&e!==x.id&&Object(d.jsxs)("div",{style:{padding:10,margin:2,border:"1px solid red"},children:[Object(d.jsx)("div",{children:Object(d.jsx)("video",{id:e,autoPlay:!0,muted:!0,style:{flex:1,border:"1px solid green",maxWidth:200,maxHeight:200}})}),Object(d.jsxs)("div",{style:{textAlign:"center"},children:[" ","USER-",n," -(",s[e],")"]})]},e)},"aaa"+e)}))})]}),Object(d.jsx)("div",{onClick:function(){console.log(m.connections)},children:"Footer"})]})};function S(){return Object(d.jsx)(l.a,{children:Object(d.jsx)("div",{children:Object(d.jsxs)(a.c,{children:[Object(d.jsx)(a.a,{path:"/creat-meeting",children:Object(d.jsx)(u,{})}),Object(d.jsx)(a.a,{path:"/meeting/:id",children:Object(d.jsx)(y,{})}),Object(d.jsx)(a.a,{path:"/",children:Object(d.jsx)(y,{})})]})})})}var k=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,59)).then((function(n){var t=n.getCLS,c=n.getFID,o=n.getFCP,i=n.getLCP,r=n.getTTFB;t(e),c(e),o(e),i(e),r(e)}))};s.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsx)(S,{})}),document.getElementById("root")),k()}},[[57,1,2]]]);
//# sourceMappingURL=main.9380f0c2.chunk.js.map